<html>
  <head>
    <meta charset="utf-8">
    <title>Groove2Groove</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <div class="container mt-3 pb-2" style="display: none;">
      <h1>Groove2Groove demo</h1>
      <p>Either pick a preset, or upload your own content &amp; style input below. Bear in mind that some files work better than others due to possible mistakes in metadata or other inconsistencies common in MIDI files found in the wild.</p>
      <div class="row mt-1 mb-3">
        <div class="col-lg-4 col-sm-3"></div>
        <div class="col-lg-4 col-sm-6">
          <button type="button" id="presetsButton" class="btn btn-lg btn-block btn-primary"><span class="oi oi-spreadsheet" title="Presets" aria-hidden="true"></span> Load preset&hellip;</button>
        </div>
        <div class="col-lg-4 col-sm-3"></div>
      </div>
      <p>We recommend listening through headphones. If you experience glitches during playback, try refreshing the page, opening it with a recent version of Google Chrome, or saving the MIDI file and playing it locally.</p>

      <div class="section" data-sequence-id="content">
        <h2 id="conent-input">Content input</h2>
        <p>Pick a song to cover. The song needs to be in 4/4, so don't pick a waltz!
           <span class='after-content-loaded'>You can choose a specific section of the song by specifying the start and end time in beats below. Please make sure that it starts on a downbeat.</span></p>
        <div class="row">
          <div class="input-group col-md-4 col-lg-6 mb-1 mb-md-0">
            <div class="custom-file">
               <input id="contentFile" name="contentFile" type="file" class="custom-file-input midi-input">
               <label for="contentFile" class="custom-file-label text-truncate">Choose MIDI file&hellip;</label>
            </div>
          </div>
          <div class="input-group col-sm-6 col-md-4 col-lg-3 mb-1 mb-sm-0 after-content-loaded">
            <div class="input-group-prepend">
              <label for="contentStartTime" class="input-group-text">Start beat</label>
            </div>
            <input type="number" class="form-control start-time" id="contentStartTime" name="contentStartTime" value="0" min="0" step="1">
          </div>
          <div class="input-group col-sm-6 col-md-4 col-lg-3 after-content-loaded">
            <div class="input-group-prepend">
              <label for="contentEndTime" class="input-group-text">End beat</label>
            </div>
            <input type="number" class="form-control end-time" id="contentEndTime" name="contentEndTime" min="0" step="1">
          </div>
        </div>
        <div class="card visualizer-card mt-2 after-content-loaded">
          <div class="card-header">
            <div class="d-flex flex-row">
              <div class="p-2">Instruments:</div>
              <div class="p-2 instrument-toggles">
              </div>
            </div>
          </div>
          <div class="visualizer-container">
            <svg></svg>
          </div>
          <div class="card-footer">
            <form class="form-inline d-flex mb-0">
              <div class="input-group p-2">
                <button type="button" class="btn btn-primary save-button"><span class="oi oi-data-transfer-download" title="Save" aria-hidden="true"></span> Save</button>
              </div>
              <div class="input-group p-2">
                <button type="button" class="btn btn-primary play-button"><span class="oi oi-media-play" title="Play" aria-hidden="true"></span> <span class="text">Play</span></button>
              </div>
              <div class="input-group p-2 flex-grow-1">
                <input type="range" class="custom-range seek-slider" min="0" value="0" step="0.1" disabled>
              </div>
              <div class="input-group p-2">
                <div class="input-group-prepend">
                  <label for="contentTempo" class="input-group-text">Tempo</label>
                </div>
                <input type="number" class="form-control tempo" id="contentTempo" name="contentTempo" min="20" step="any" max="300" size="4">
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="section after-content-loaded" data-sequence-id="style">
        <h2>Style input</h2>
        <p>This is the song to take the style from.
           <span class="after-style-loaded">For best results, pick an 8-bar (32-beat) section.</span></p>
        <div class="row">
          <div class="input-group col-md-4 col-lg-6 mb-1 mb-md-0">
            <div class="custom-file">
               <input id="styleFile" name="styleFile" type="file" class="custom-file-input midi-input">
               <label for="styleFile" class="custom-file-label text-truncate">Choose MIDI file...</label>
            </div>
          </div>
          <div class="input-group col-sm-6 col-md-4 col-lg-3 mb-1 mb-sm-0 after-style-loaded">
            <div class="input-group-prepend">
              <label for="styleStartTime" class="input-group-text">Start beat</label>
            </div>
            <input type="number" class="form-control start-time" id="styleStartTime" name="styleStartTime" value="0" min="0" step="1">
          </div>
          <div class="input-group col-sm-6 col-md-4 col-lg-3 after-style-loaded">
            <div class="input-group-prepend">
              <label for="styleEndTime" class="input-group-text">End beat</label>
            </div>
            <input type="number" class="form-control end-time" id="styleEndTime" name="styleEndTime" min="0" step="1">
          </div>
        </div>
        <div class="card visualizer-card mt-2 after-style-loaded">
          <div class="card-header">
            <div class="d-flex flex-row">
              <div class="p-2">Instruments:</div>
              <div class="p-2 instrument-toggles">
              </div>
            </div>
          </div>
          <div class="visualizer-container">
            <svg></svg>
          </div>
          <div class="card-footer">
            <form class="form-inline d-flex mb-0">
              <div class="input-group p-2">
                <button type="button" class="btn btn-primary save-button"><span class="oi oi-data-transfer-download" title="Save" aria-hidden="true"></span> Save</button>
              </div>
              <div class="input-group p-2">
                <button type="button" class="btn btn-primary play-button"><span class="oi oi-media-play" title="Play" aria-hidden="true"></span> <span class="text">Play</span></button>
              </div>
              <div class="input-group p-2 flex-grow-1">
                <input type="range" class="custom-range seek-slider" min="0" value="0" step="0.1" disabled>
              </div>
              <div class="input-group p-2">
                <div class="input-group-prepend">
                  <label for="styleTempo" class="input-group-text">Tempo</label>
                </div>
                <input type="number" class="form-control tempo" id="styleTempo" name="styleTempo" min="20" step="any" max="300" size="4">
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="section after-style-loaded" data-sequence-id="output">
        <h2>Output</h2>
        <p>Now listen to an accompaniment generated by one of our models (if you have loaded custom inputs above, click <strong>Generate</strong> now).
           We recommend using the model <strong>without velocity</strong>, which generally gives the best results.</p>
        <p>Feel free to hit Generate again (with sampling enabled) to get a different result.
           Try playing around with the temperature to make the result sound more or less &lsquo;random&rsquo;, but do not get burnt (safe values are around 0.6)!</p>
        <form class="form-inline">
          <div class="input-group mb-1 mr-2">
            <div class="input-group-prepend">
              <div class="input-group-text">
                Model
              </div>
            </div>
            <select class="form-control" id="modelName" name="modelName">
              <option value="v01_drums">without velocity</option>
              <option value="v01_drums_vel">with velocity</option>
              <option value="v01_drums_vel_perf">with velocity, &Delta;-encoding</option>
            </select>
          </div>
          <div class="input-group mb-1 mr-2">
            <div class="input-group-prepend">
              <button type="button" class="btn btn-primary generate-button"><span class="oi oi-cog" title="Generate" aria-hidden="true"></span> Generate</button>
            </div>
            <div class="input-group-prepend input-group-append">
              <div class="input-group-text">
                <input type="checkbox" id="samplingCheckbox" name="samplingCheckbox" checked>
                <label for="samplingCheckbox" class="ml-1 mb-0">Sample with temperature:</label>
              </div>
            </div>
            <input type="number" class="form-control" id="samplingTemperature" name="samplingTemperature" value="0.6" min="0.0" step="0.1" max="1.5" style="max-width: 4.5em">
          </div>
        </form>
        <div class="card visualizer-card mt-2 after-output-loaded">
          <div class="card-header">
            <div class="d-flex flex-row">
              <div class="p-2">Instruments:</div>
              <div class="p-2 instrument-toggles"></div>
            </div>
          </div>
          <div class="visualizer-container">
            <svg></svg>
          </div>
          <div class="card-footer">
            <form class="form-inline d-flex mb-0">
              <div class="input-group p-2">
                <button type="button" class="btn btn-primary save-button"><span class="oi oi-data-transfer-download" title="Save" aria-hidden="true"></span> Save</button>
              </div>
              <div class="input-group p-2">
                <button type="button" class="btn btn-primary play-button"><span class="oi oi-media-play" title="Play" aria-hidden="true"></span> <span class="text">Play</span></button>
              </div>
              <div class="input-group p-2 flex-grow-1">
                <input type="range" class="custom-range seek-slider" min="0" value="0" step="0.1" disabled>
              </div>
              <div class="input-group p-2">
                <div class="input-group-prepend">
                  <label for="outputTempo" class="input-group-text">Tempo</label>
                </div>
                <input type="number" class="form-control tempo" id="outputTempo" name="outputTempo" min="20" step="any" max="300" size="4">
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="section after-output-loaded" data-sequence-id="remix">
        <h2>Remix</h2>
        <p>Create an actual cover song by remixing the output with some of the original tracks (e.g.&nbsp;melody)!</p>
        <div class="card visualizer-card mt-2 after-output-loaded">
          <div class="card-header">
            <div class="d-flex flex-row">
              <div class="p-2">Output:</div>
              <div class="p-2 instrument-toggles" id="remixOutputToggles"></div>
            </div>
            <div class="d-flex flex-row">
              <div class="p-2">Content:</div>
              <div class="p-2 instrument-toggles" id="remixContentToggles"></div>
            </div>
          </div>
          <div class="visualizer-container">
            <svg></svg>
          </div>
          <div class="card-footer">
            <form class="form-inline d-flex mb-0">
              <div class="input-group p-2">
                <button type="button" class="btn btn-primary save-button"><span class="oi oi-data-transfer-download" title="Save" aria-hidden="true"></span> Save</button>
              </div>
              <div class="input-group p-2">
                <button type="button" class="btn btn-primary play-button"><span class="oi oi-media-play" title="Play" aria-hidden="true"></span> <span class="text">Play</span></button>
              </div>
              <div class="input-group p-2 flex-grow-1">
                <input type="range" class="custom-range seek-slider" min="0" value="0" step="0.1" disabled>
              </div>
              <div class="input-group p-2">
                <div class="input-group-prepend">
                  <label for="remixTempo" class="input-group-text">Tempo</label>
                </div>
                <input type="number" class="form-control tempo" id="remixTempo" name="remixTempo" min="20" step="any" max="300" size="4">
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="col-md-4 ml-auto mr-auto mt-1 mb-3 after-output-loaded">
        <button id="savePreset" name="savePreset" class="btn btn-success btn-block"><span class="oi oi-data-transfer-download" title="Save" aria-hidden="true"></span> Save preset</button>
      </div>
    </div>

    <footer class="footer">
      <div class="container" style="display: none;">
        Created by <a href="https://ondrej.cifka.com" target="_blank">Ondřej Cífka</a>
        at <a href="https://www.telecom-paris.fr" target="_blank">Télécom Paris</a>.
        Built with <a href="https://github.com/magenta/magenta-js/" target="_blank">Magenta.js</a>.
      </div>
    </footer>

    <div class="modal" id="presetModal" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
      <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Presets</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <table class="table">
              <colgroup>
                <col style="width: 8em">
              </colgroup>
              <thead>
                <tr><th></th><th>Content</th><th>Style</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td><button class="btn btn-block btn-success" data-preset-url="/presets/inwalked__december.json" data-content-name="In Walked Bud" data-style-name="December"><span class="oi icon-sm oi-arrow-circle-bottom" title="Load" aria-hidden="true"></span><span class="d-none d-sm-inline"> Load</span></button></td>
                  <td>In Walked Bud (Thelonious Monk, unknown version) <a href="https://youtu.be/FuHjgKQDofs?t=13" target="_blank"><span class="oi icon-sm oi-external-link" title="Listen on YouTube" aria-hidden="true"></span></a></td>
                  <td>December (Collective Soul) <a href="https://youtu.be/6exsatE-DUk?t=189" target="_blank"><span class="oi icon-sm oi-external-link" title="Listen on YouTube" aria-hidden="true"></span></a></td>
                </tr>
                <tr>
                  <td><button class="btn btn-block btn-success" data-preset-url="/presets/lithium__fanvoy.json" data-content-name="Lithium" data-style-name="Fantastic Voyage"><span class="oi icon-sm oi-arrow-circle-bottom" title="Load" aria-hidden="true"></span><span class="d-none d-sm-inline"> Load</span></button></td>
                  <td>Lithium (Nirvana) <a href="https://youtu.be/pkcJEvMcnEg" target="_blank"><span class="oi icon-sm oi-external-link" title="Listen on YouTube" aria-hidden="true"></span></a></td>
                  <td>Fantastic Voyage (Lakeside) <a href="https://youtu.be/-1YjmXSyHa8?t=125" target="_blank"><span class="oi icon-sm oi-external-link" title="Listen on YouTube" aria-hidden="true"></span></a></td>
                </tr>
                <tr>
                  <td><button class="btn btn-block btn-success" data-preset-url="/presets/yursong__atIknew.json" data-content-name="Your Song" data-style-name="And Then I Knew"><span class="oi icon-sm oi-arrow-circle-bottom" title="Load" aria-hidden="true"></span><span class="d-none d-sm-inline"> Load</span></button></td>
                  <td>Your Song (Elton John) <a href="https://youtu.be/GlPlfCy1urI" target="_blank"><span class="oi icon-sm oi-external-link" title="Listen on YouTube" aria-hidden="true"></span></a></td>
                  <td>And Then I Knew (Pat Metheny) <a href="https://youtu.be/35iZSbmRie8?t=71" target="_blank"><span class="oi icon-sm oi-external-link" title="Listen on YouTube" aria-hidden="true"></span></a></td>
                </tr>
                <tr>
                  <td><button class="btn btn-block btn-success" data-preset-url="/presets/cumparsita_tango__sunflower.json" data-content-name="La cumparsita" data-style-name="Little Sunflower"><span class="oi icon-sm oi-arrow-circle-bottom" title="Load" aria-hidden="true"></span><span class="d-none d-sm-inline"> Load</span></button></td>
                  <td>La cumparsita (Gerardo Matos Rodríguez) <a href="https://youtu.be/NY0MLG-IrSU" target="_blank"><span class="oi icon-sm oi-external-link" title="Listen on YouTube" aria-hidden="true"></span></a></td>
                  <td>Little Sunflower (Freddie Hubbard, unknown version) <a href="https://youtu.be/OtB8dEuEmNM" target="_blank"><span class="oi icon-sm oi-external-link" title="Listen on YouTube" aria-hidden="true"></span></a></td>
                </tr>
                <tr>
                  <td><button class="btn btn-block btn-success" data-preset-url="/presets/Mendelssohn-ViolinConcerto64-Alegro__van_halen-jump.json" data-content-name="Violin Concerto in E minor, I. Allegro molto appassionato" data-style-name="Jump"><span class="oi icon-sm oi-arrow-circle-bottom" title="Load" aria-hidden="true"></span><span class="d-none d-sm-inline"> Load</span></button></td>
                  <td>Violin Concerto Op. 64 (Mendelssohn) <a href="https://youtu.be/fc00OQw59lM" target="_blank"><span class="oi icon-sm oi-external-link" title="Listen on YouTube" aria-hidden="true"></span></a></td>
                  <td>Jump (Van Halen) <a href="https://youtu.be/SwYN7mTi6HM?t=14" target="_blank"><span class="oi icon-sm oi-external-link" title="Listen on YouTube" aria-hidden="true"></span></a></td>
                </tr>
                <tr>
                  <td><button class="btn btn-block btn-success" data-preset-url="/presets/james_brown-i_feel_good__TECHNO.json" data-content-name="I Got You (I Feel Good)" data-style-name="TECHNO.MID"><span class="oi icon-sm oi-arrow-circle-bottom" title="Load" aria-hidden="true"></span><span class="d-none d-sm-inline"> Load</span></button></td>
                  <td>I Got You (I Feel Good) (James Brown) <a href="https://youtu.be/U5TqIdff_DQ" target="_blank"><span class="oi icon-sm oi-external-link" title="Listen on YouTube" aria-hidden="true"></span></a></td>
                  <td>TECHNO.MID (artist unknown)</td>
                </tr>
                <tr>
                  <td><button class="btn btn-block btn-success" data-preset-url="/presets/Ill_Be_Missing_You__halfn.json" data-content-name="I'll Be Missing You" data-style-name="Half Nelson"><span class="oi icon-sm oi-arrow-circle-bottom" title="Load" aria-hidden="true"></span><span class="d-none d-sm-inline"> Load</span></button></td>
                  <td>I'll Be Missing You (Puff Daddy/Sting) <a href="https://youtu.be/NKMtZm2YuBE?t=15" target="_blank"><span class="oi icon-sm oi-external-link" title="Listen on YouTube" aria-hidden="true"></span></a></td>
                  <td>Half Nelson (Miles Davis, unknown version)</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="loadingModal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false" style="display: none;">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-body text-center">
            <span class="spinner-border spinner-border-sm text-primary mr-2" role="status"></span><span class="loading-text text-primary">Loading&hellip;</span>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="errorModal" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Error</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p class="error-text"></p>
          </div>
        </div>
      </div>
    </div>

    <script src="/bundle.js"></script>
    <script>
      main.init({
        apiUrl: 'https://indexweb.enst.fr:5000'
      });

      $('button[data-preset-url]').click(function(event) {
        event.preventDefault();
        $('#presetModal').modal('hide');
        main.loadPresetFromUrl(this.dataset.presetUrl);
      });
    </script>
  </body>
</html>
