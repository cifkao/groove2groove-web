<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Groove2Groove</title>

    <meta name="robots" content="noindex">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/open-iconic/1.1.1/font/css/open-iconic-bootstrap.min.css" integrity="sha256-BJ/G+e+y7bQdrYkS2RBTyNfBHpA9IuGaPmf9htub5MQ=" crossorigin="anonymous" />

    <style type='text/css'>
      h1 {
        text-align: center;
      }

      h2 {
        margin-top: 2.5rem;
      }

      h3 {
        margin-top: 2rem;
      }

      #exampleTemplate {
        display: hide;
      }

      .example {
        margin-bottom: 2ex;
      }

      .example .piano-roll {
        max-width: 100%;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1 class="mt-2">Groove2Groove</h1>
      <p>This website accompanies the paper &lsquo;Groove2Groove: One-shot accompaniment style transfer with supervision from synthetic data&rsquo;. For now, it is confidential and only meant for the paper review.</p>

      <div class="row mt-1 mb-3">
        <div class="col-lg-3 col-sm-1"></div>
        <div class="col-lg-3 col-sm-5">
          <a href="demo.html" target="_blank" role="button" class="btn btn-block btn-lg btn-secondary">Static demo</a>
        </div>
        <div class="col-lg-3 col-sm-5 mt-2 mt-sm-0">
          <a href="restricted/demo-full.html" target="_blank" role="button" class="btn btn-block btn-lg btn-success">Interactive demo</a>
        </div>
        <div class="col-lg-3 col-sm-1"></div>
      </div>

      <h2>Data and other material</h2>
      <ul>
        <li><a href="data/groove2groove-data-v1.0-sample.tar.gz">A sample of the data</a> (the full dataset will be released once the paper is published)</li>
        <li><a href="data/styles.tsv">Table of styles</a> as a TSV file</li>
        <li><a href="https://github.com/cifkao/groove2groove/blob/master/model.yaml">Configuration file</a> with hyperparameter settings</li>
      </ul>


      <h2>Style interpolation examples</h2>
      <p>
        The following are selected examples of interpolation between styles from the synthetic test set.
        In each example, we linearly interpolate between the embeddings of two style inputs while the
        content input is fixed.
        Use the slider to adjust the interpolation coefficient <i>&alpha;</i> and watch the output change.
      </p>
      <p>
        In the first three examples, we performed the interpolation twice&nbsp;&ndash; on a pair of bass embeddings and a pair of piano embeddings, respectively&nbsp;&ndash; and combined the outputs.
        The last example is bass-only.
      </p>

      <div class="example" id="exampleTemplate">
        <h3 class="heading"><span class="style-a"></span> &rarr; <span class="style-b"></span></h3>
        <canvas class="piano-roll"></canvas>
        <form class="form-inline">
          <label style="font-variant-numeric: tabular-nums"><i>&alpha;</i>&nbsp;=&nbsp;<span class="alpha-value">0</span></label>
          <input type="range" class="custom-range alpha-range ml-2" min="0" max="100" step="1" value="0" style="max-width: 200px">
          <button type="button" class="btn btn-primary ml-2 play-button"><span class="oi oi-media-play" title="Play" aria-hidden="true"></button>
        </form>
      </div>

      <div id="blendingExamples">
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/xcash/bootstrap-autocomplete@v2.2.2/dist/latest/bootstrap-autocomplete.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/13.8.21/Tone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@magenta/music@^1.0.0/es6/core.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js" defer></script>

    <script>
      const VIZ_CONFIG = {
        pixelsPerTimeStep: 40,
        noteHeight: 3,
        minPitch: 24,
        maxPitch: 90
      };

      const DATA = [
        {
          styleA: "Country Arpeggios",
          styleB: "“Hank Sr.” Classic Country Ballad",
          path: "Piano_Bass/09_ARPEGGIO_b_C~HNKSR1_b/00",
          vizConfig: {
            maxPitch: 80
          }
        },
        {
          styleA: "80s Rock Blues",
          styleB: "12/8 Blues",
          path: "Piano_Bass/16_Clashin1_b_BEEBSLO_b/00",
          comment: "In the 80s Rock Blues style, the “Piano” track actually contains an electric guitar, but we play it using a piano sound here."
        },
        {
          styleA: "“Eagles” Contemporary Country",
          styleB: "Salsa Guajira",
          path: "Piano_Bass/03_c_eagle2_a_Guajir2_b/00"
        },
        {
          styleA: "Bossa Lite",
          styleB: "“Creedence” 70s Funk Country Rock",
          path: "Bass/11_BosaLite_a_CREEDNCE_a/10",
          vizConfig: {
            maxPitch: 50
          }
        },
      ];

      const EXAMPLE_TEMPLATE = $("#exampleTemplate").detach().removeAttr("id");

      var activeVisualizer;

      var player = new core.SoundFontPlayer("https://storage.googleapis.com/magentadata/js/soundfonts/sgm_plus",
                                            Tone.Master, null, null,
                                            {
                                              run: (note) => activeVisualizer && activeVisualizer.redraw(note),
                                              stop: playbackStopHandler
                                            });

      function playbackStopHandler() {
        if (activeVisualizer) {
          activeVisualizer.redraw({});
          activeVisualizer = null;
        }
      }

      DATA.forEach(function(item) {
        var e = EXAMPLE_TEMPLATE.clone(true);
        e.data("data", item);
        e.find("input, button").attr("disabled", true);
        e.find(".style-a").text(item.styleA);
        e.find(".style-b").text(item.styleB);
        if (item.comment)
          $("<p>").text(item.comment).insertAfter(e.find(".heading"));
        e.appendTo("#blendingExamples");
        Promise.all(
          (function() {
            var a = [];
            for (var i = 0; i <= 100; i += 1) {
              a.push(i / 100);
            }
            return a;
          })().map(function(alpha) {
            var url = "data/blending/" + item.path + "/" + alpha.toFixed(2) + ".mid";
            return core.urlToNoteSequence(url)
          })
        ).then(function(result) {
          e.data("sequences", result);
          e.find(".alpha-range").trigger("input");
          e.find("input, button").attr("disabled", false);
        });
      });

      $(".alpha-range").on("input", function() {
        var e = $(this).closest(".example");
        if (activeVisualizer && activeVisualizer == e.data("visualizer")) {
          player.stop();
          playbackStopHandler();
        }

        var alphaIndex = $(this).val();
        e.find(".alpha-value").text((alphaIndex / 100).toFixed(2));
        var canvas = e.find(".piano-roll")[0];
        var vizConfig = Object.assign({}, VIZ_CONFIG, e.data("data").vizConfig);
        var visualizer = new core.PianoRollCanvasVisualizer(
            e.data("sequences")[alphaIndex], canvas, vizConfig);
        visualizer.redraw({});
        e.data("visualizer", visualizer);
      });

      $(".play-button").click(function() {
        if(player.isPlaying()) {
          player.stop();
          playbackStopHandler();
          return;
        }

        activeVisualizer = $(this).closest(".example").data("visualizer");
        player.start(activeVisualizer.noteSequence);
      });
    </script>
  </body>

</html>
